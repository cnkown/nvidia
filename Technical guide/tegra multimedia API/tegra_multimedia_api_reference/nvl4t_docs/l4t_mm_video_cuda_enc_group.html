<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--
 * Copyright (c) 2009-2014 NVIDIA CORPORATION.  All rights reserved.
 *
 * NVIDIA Corporation and its licensors retain all intellectual property
 * and proprietary rights in and to this software, related documentation
 * and any modifications thereto.  Any use, reproduction, disclosure or
 * distribution of this software and related documentation without an express
 * license agreement from NVIDIA Corporation is strictly prohibited.
-->
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>Jetson Linux Multimedia API Reference: 03_video_cuda_enc</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="Nvidia.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="reverb-search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="nv.css" rel="stylesheet" type="text/css" />
<style>
 body {
 background-position: 350px 150px;
 background-image: url(watermark.png);
 background-repeat: no-repeat;
 background-attachment: fixed;
 }
</style>
<script type="text/javascript" charset="utf-8" src="https://assets.adobedtm.com/b92787824f2e0e9b68dc2e993f9bd995339fe417/satelliteLib-7ba51e58dc61bcb0e9311aadd02a0108ab24cc6c.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table width="99%" border="0" cellspacing="1" cellpadding="1">
  <tbody>
    <tr valign="middle">
      <td rowspan="2" height="44" width="19%">
        <img src="./NVLogo_2D_H.jpg" width="204" height="44"></td>
      <td width="81%" height="44">
        <h2 style="text-align:right">Jetson Linux Multimedia API Reference</h2>
        <h4 style="text-align:right">
        32.4.3 Release</h4>
    </td>
  </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li><a href="grp_terms.html"><span>Important&#160;Terms</span></a></li>
      <li><a href="modules.html"><span>API&#160;Modules</span></a></li>
      <li><a href="l4t_mm_test_group.html"><span>Sample&#160;Applications</span></a></li>
      <li><a href="mmapi_tools.html"><span>Tools</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="usergroup0.html"><span>More</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('l4t_mm_video_cuda_enc_group.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">03_video_cuda_enc </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#build_and_run">Building and Running</a></li>
<li><a href="#flow">Flow</a></li>
<li><a href="#key">Key Structure and Classes</a></li>
</ul>
<hr/>
<p> <a class="anchor" id="overview"></a> </p><h2>Overview</h2>
<p>The Video CUDA Encoder sample demonstrates how to capture use libv4l2 API to encode H.264/H.265 video streams. Before beginning encoding, it uses the NVIDIA<sup>&reg;</sup> CUDA<sup>&reg;</sup> API to render a black rectangle on the input YUV image data; the same buffer is used and shared by the decode component.</p>
<p><a class="anchor" id="build_and_run"></a> </p><hr/>
 <h2>Building and Running</h2>
<h4>Prerequisites</h4>
<ul>
<li>You have followed Steps 1-3 in <a class="el" href="mmapi_build.html">Building and Running</a>.</li>
<li>If you are building from your host Linux PC (x86), you have followed Step 4 in <a class="el" href="mmapi_build.html">Building and Running</a>.</li>
</ul>
<h3>To build:</h3>
<ul>
<li>Enter: <pre class="fragment"> $ cd $HOME/tegra_multimedia_api/samples/03_video_cuda_enc
 $ make
</pre></li>
</ul>
<h3>To run</h3>
<ul>
<li>Enter: <pre class="fragment"> $ ./video_cuda_enc &lt;in-file&gt; &lt;in-width&gt; &lt;in-height&gt; &lt;encoder-type&gt; &lt;out-file&gt; [OPTIONS]
</pre></li>
</ul>
<h3>Example</h3>
<pre class="fragment">   $ ./video_cuda_enc ../../data/Video/sample_outdoor_car_1080p_10fps.yuv 1920 1080 H264 test.h264
</pre><dl class="section note"><dt>Note</dt><dd>The <code>video_cuda_enc</code> sample consumes a YUV file. If you do not already have a YUV file, you can use the <code>video_dec_cuda</code> sample to generate one. For example: <pre class="fragment"> $ cd $HOME/tegra_multimedia_api/samples/02_video_dec_cuda/
 $ ./video_dec_cuda ../../data/Video/sample_outdoor_car_1080p_10fps.h264 H264 --disable-rendering \
   -o ../../data/Video/sample_outdoor_car_1080p_10fps.yuv -f 2
</pre></dd></dl>
<p><a class="anchor" id="flow"></a> </p><hr/>
 <h2>Flow</h2>
<p>The following diagram shows the flow through this sample.</p>
<div class="image">
<img src="l4t_mm_video_cuda_enc.jpg" />
</div>
<p>The <code>NvEGLImageFromFd</code> NV-defined API returns an EGLImage pointer from the file descriptor buffer that is allocated by Tegra. CUDA then uses EGLImage buffer to render the rectangle. The buffer then performs the video encode operation and encodes it to either an H.264 or H.265 video stream.</p>
<p><a class="anchor" id="key"></a> </p><hr/>
 <h2>Key Structure and Classes</h2>
<p>The <code>struct context_t</code> global structure manages all of the resources in the application.</p>
<table class="doxtable">
<tr>
<th>NvVideoConverter </th><th>Description  </th></tr>
<tr>
<td>class <a href="classNvVideoEncoder.html">NvVideoEncoder</a> </td><td>This class contains all video encode related elements and functions. </td></tr>
<tr>
<td>EGLImageHKR </td><td>Specifies the EGLImage used for CUDA processing. </td></tr>
</table>
<p>The <a href="classNvVideoConverter.html">NvVideoConverter</a> class packages all video converting related elements and functions. The sample uses the following key members:</p>
<table class="doxtable">
<tr>
<th>NvVideoConverter </th><th>Description  </th></tr>
<tr>
<td><a href="classNvV4l2Element.html#aaba251827cef1b23e7c42f776e95fee5">output_plane</a> </td><td>Specifies the output plane. </td></tr>
<tr>
<td><a href="classNvV4l2Element.html#a91806d7ed13b4b2c48758e8a02f46c6d">capture_plane</a> </td><td>Specifies the capture plane. </td></tr>
<tr>
<td><a href="classNvVideoEncoder.html#aabb707f9188805ab7f097f82b3648351">createVideoEncoder</a> </td><td>Static function to create video encode object. </td></tr>
<tr>
<td><a href="classNvV4l2Element.html#aaec1f40b777bb98870f18766690d7984">setExtControls</a> </td><td>Sets external control to V4l2 device. </td></tr>
<tr>
<td><a href="#NvVideoConverter::setOutputPlaneFormat">setOutputPlaneFormat</a> </td><td>Sets the output plane format. </td></tr>
<tr>
<td><a href="#NvVideoConverter::setCapturePlaneFormat] &lt;td&gt; Sets the capture plane format. 
&lt;tr&gt;&lt;td&gt; [isInError](classNvElement.html#a3ecd42c9dda2cec9506cf2ea8fa021fe">setCapturePlaneFormat</a> </td><td>Checks if under error state. </td></tr>
</table>
<p>Class NvVideoEncoder contains two key elements: <code>output_plane</code> and <code>capture_plane</code>. These objects are derived from class type <a href="group__l4t_mm__nvv4lelementplane__group.html">NvV4l2ElementPlane</a>. The sample uses the following key members:</p>
<table class="doxtable">
<tr>
<th>NvV4l2ElementPlane </th><th>Description  </th></tr>
<tr>
<td><a href="classNvV4l2ElementPlane.html#a89959f455e5222f686187cc826b1b345">setupPlane</a> </td><td>Sets up the plane of V4l2 element. </td></tr>
<tr>
<td><a href="classNvV4l2ElementPlane.html#af89cfe87d8f818beb0478bcf5b72574c">deinitPlane</a> </td><td>Destroys the plane of V4l2 element. </td></tr>
<tr>
<td><a href="classNvV4l2ElementPlane.html#a03164dde4d7ab41f3e92b41e13059316">setStreamStatus</a> </td><td>Starts/stops the stream. </td></tr>
<tr>
<td><a href="classNvV4l2ElementPlane.html#a37f213325e0e4857180f5b2319317d6a">setDQThreadCallback</a> </td><td>Sets the callback function of dqueue buffer thread. </td></tr>
<tr>
<td><a href="classNvV4l2ElementPlane.html#a31f77f5e5ed1f320caa44a868a7cbedd">startDQThread</a> </td><td>Starts the thread of dqueue buffer. </td></tr>
<tr>
<td><a href="classNvV4l2ElementPlane.html#aa798d14493de321fa90aeab6d944ca87">stopDQThread</a> </td><td>Stops the thread of dqueue buffer. </td></tr>
<tr>
<td><a href="classNvV4l2ElementPlane.html#af4d52964fcfd37082f47682e457f5e95">qBuffer</a> </td><td>Queues the V4l2 buffer. </td></tr>
<tr>
<td><a href="classNvV4l2ElementPlane.html#a8dfcbc666ee6f36a02abfb1170ae05cd">dqBuffer</a> </td><td>Dqueues V4l2 buffer. </td></tr>
<tr>
<td><a href="classNvV4l2ElementPlane.html#ac5cd394a7e0a4afd69395759aeac8787">getNumBuffers</a> </td><td>Gets the number of V4l2 buffers. </td></tr>
<tr>
<td><a href="classNvV4l2ElementPlane.html#a868d438908f3d267dd4af1033133892f">getNthBuffer</a> </td><td>Gets the nth V4l2 buffer. </td></tr>
</table>
<p>Two global functions are used to create and destroy EGLImage from the dmabuf file descriptor:</p>
<table class="doxtable">
<tr>
<th>Global Function </th><th>Description  </th></tr>
<tr>
<td>NvEGLImageFromFd </td><td>Creates an EGLImage from dmabuf fd. </td></tr>
<tr>
<td>NvDestroyEGLImage </td><td>Destroys the EGLImage. </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->

  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">
        Advance Information | Subject to Change |
        Generated by NVIDIA | Thu Jul 2 2020 14:15:48 |
        PR-08664-R32
      </li>
     </ul>
  </div>
<script type="text/javascript">if (_satellite) _satellite.pageBottom();</script>
</body>
</html>
